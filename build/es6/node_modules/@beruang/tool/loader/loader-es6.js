window.BeruangLoader=window.BeruangLoader||function(){return{_map:{},//tabungan yg sdh load, {url:module}
_queue:{},//map url dengan array fungsi callback=> url:[callback-1,callback-2,...]
_enqueue:function(url){//antrian masuk
if(!this._queue.hasOwnProperty(url)){//jika url belum didaftarkan
this._queue[url]=[];//url:[] (array kosong, sediakan tempat untuk array callback)
}},_dequeue:function(url){//antrian keluar
let arr=this._queue[url];//url selesai diloading, ambil array
for(let i=0;i<arr.length;i++){//panggil semua callback satu demi satu
arr[i].call();//callback dijalankan, sama seperti
//let f = arr[i];
//f();
}delete this._queue[url];//hapus key dari _queue
},_probe:function(url,callback){let callbackArray=this._queue[url];if(callbackArray){//sibuk, masukkan callback k dlm _queue dg key url
callbackArray.push(callback);//jika url dalam proses loading maka daftarkan callback ke dalam antrian
}else{callback();//tidak ada antrian maka callback langsung dijalankan (tidak perlu diantri)
}},toAbsoluteURL:function(url){this._a=this._a||document.createElement("a");this._a.href=url;// <a href="hoge.html">
return this._a.href;// -> "http://example.com/hoge.html"
},importModule:function(url,callback){const absURL=this.toAbsoluteURL(url);let f=()=>{//callback
let m=this._map[absURL];if(m){if(callback){callback(m)}}else{this._enqueue(absURL);//daftarkan url sbg key dalam _queue
const key="$importModule$"+Math.random().toString(32).slice(2),script=document.createElement("script"),destructor=()=>{//fungsi destructor
this._dequeue(absURL);delete window[key];script.onerror=null;script.onload=null;document.head.removeChild(script);URL.revokeObjectURL(script.src);//menghapus blob dari memory
script.src=""};script.defer="defer";script.type="module";script.onerror=()=>{//jika gagal load, antrian hapus dari this._queue
destructor();throw"failed loading "+absURL};script.onload=()=>{//jika berhasil load, antrian hapus dari this._queue
this._map[absURL]=window[key];//daftarkan module ke map
if(callback){callback(window[key])}destructor()};const src=`import * as m from "${absURL}"; window.${key} = m;`,blob=new Blob([src],{type:"text/javascript"});// source code
//blob: binary large object seperti file, pesan tempat di memory
script.src=URL.createObjectURL(blob);document.head.appendChild(script)}};this._probe(absURL,f);//memeriksa antrian, jalankan callback "f" kalau antrian selesai
},importMultiModule:function(urlarr,callback){let len=urlarr.length,f;if(callback){let ms=[],count=0;f=(idx,module)=>{ms[idx]=module;if(len<=++count){callback.apply(null,ms)}}}for(let i=0;i<len;i++){this.importModule(urlarr[i],f?m=>{f(i,m)}:null)}}}}();