import{html,PolymerElement}from"../../../@polymer/polymer/polymer-element.js";import{GestureEventListeners}from"../../../@polymer/polymer/lib/mixins/gesture-event-listeners.js";import{FlattenedNodesObserver}from"../../../@polymer/polymer/lib/utils/flattened-nodes-observer.js";import{afterNextRender}from"../../../@polymer/polymer/lib/utils/render-status.js";import*as Gestures from"../../../@polymer/polymer/lib/utils/gestures.js";import"../../../@polymer/iron-flex-layout/iron-flex-layout.js";import"../../../@webcomponents/shadycss/entrypoints/apply-shim.js";import{BeruangBehavior}from"../../beruang-behavior.js";import{BrownBehavior}from"../brown-behavior.js";import"../brown-style.js";class BrownTabDesktop extends BrownBehavior(BeruangBehavior(GestureEventListeners(PolymerElement))){static get template(){return html`
      <style  include="brown-style">
        :host {
          @apply --layout-vertical;
        }

        :host > #header {
          @apply --layout-flex-none;
          @apply --layout-self-stretch;
          @apply --layout-horizontal;
          @apply --layout-center;
          background-color: var(--tab-header-bgcolor);
          min-height: var(--tab-header-minheight);
          padding-left:10px;
        }

        :host([dynamic]) > #header {
          padding-left:40px;
        }

        :host > #header > .scroller {
          @apply --layout-flex-none;
          height:16px;
          color: var(--tabitem-active-color);
          cursor:pointer;
          visibility:hidden;
        }

        :host > #header > .scroller.scroll {
          visibility:visible;
        }

        :host > #header > #header-item {
          @apply --layout-flex;
          @apply --layout-self-stretch;
          @apply --layout-horizontal;
          position:relative;
          overflow-x:hidden;
        }

        :host > #header > #header-item > ::slotted([slot=header]) {
          @apply --layout-flex-none;
          @apply --layout-self-stretch;
          padding: 0px 10px;
        }

        :host > #content {
          @apply --layout-flex;
          @apply --layout-self-stretch;
          position:relative;
          background-color: var(--tab-content-bgcolor);
        }

        :host > #content > ::slotted([slot=content]) {
          @apply --layout-fit;
          margin:5px 5px;
          font-family:var(--tab-content-font-family);
          display:none;
        }
        :host > #content > ::slotted(.content-active) {
          display:block;
        }
      </style>
      <div id="header">
        <iron-icon icon="chevron-left" id="pre-scroll" class="scroller" on-tap="_preScroll"></iron-icon>
        <div id="header-item"><slot id="header-slot" name="header"></slot></div>
        <iron-icon icon="chevron-right" id="post-scroll" class="scroller" on-tap="_postScroll"></iron-icon>
      </div>
      <div id="content"><slot name="content"></slot></div>
    `}static get properties(){return{dynamic:{type:Boolean,value:!1,reflectToAttribute:!0}}}ready(){super.ready();Gestures.addListener(this,"tap",e=>{let closing=e.target.classList.contains("closeicon"),path=event.path||event.composedPath&&event.composedPath();for(let i=0,el;i<path.length;i++){el=path[i];if("BROWN-TABITEM-DESKTOP"==el.nodeName){if(closing){//close tabitem
if(el.active){//if closing tabitem is active then set other to active
let other=this._getSibling(el,null);if(other){other.active=!0}}let content=this._getContentByDataTab(el.id);if(content){this.removeChild(content)}this.removeChild(el)}else{//set tabitem to active
if(!el.active){let other=this._getSibling(el,function(sib){return sib.active;//return true if sibling met requirement
});//search currently active tabitem
if(other){other.active=!1;//set other to non active
}this._ensureItemVisible(el);el.active=!0}}break}}});this.addEventListener("active-changed",e=>{let content=this._getContentByDataTab(e.target.id);if(!content){return}if(e.detail.active){content.classList.add("content-active")}else{content.classList.remove("content-active")}});let slot=this.shadowRoot.querySelector("#header-slot");this._observer=new FlattenedNodesObserver(slot,info=>{if(0<info.addedNodes.length||0<info.removedNodes.length){afterNextRender(this,function(){this._evaluateScroll()})}})}//ready()
connectedCallback(){super.connectedCallback();this._fWndResize=this._fWndResize||this._evaluateScroll.bind(this);window.addEventListener("resize",this._fWndResize)}disconnectedCallback(){super.disconnectedCallback();window.removeEventListener("resize",this._fWndResize)}_getSibling(el,callback){let sibling,element=el;//forward
while(sibling=element.nextElementSibling){if("BROWN-TABITEM-DESKTOP"==sibling.nodeName){if(!callback||callback(sibling)){return sibling}}element=sibling}//backward
element=el;while(sibling=element.previousElementSibling){if("BROWN-TABITEM-DESKTOP"==sibling.nodeName){if(!callback||callback(sibling)){return sibling}}element=sibling}return null}_getContentByDataTab(tabId){return this._getLightDOM(el=>{let data="BROWN-TABITEM-DESKTOP"!=el.nodeName?el.getAttribute("data-tab"):null;return tabId==data})}_getLightDOM(callback){let el=this.firstElementChild;while(el){if(callback(el)){return el}el=el.nextElementSibling}return null}_ensureItemVisible(tabItem){let container=this.shadowRoot.querySelector("#header-item"),right=tabItem.offsetLeft+tabItem.offsetWidth-container.scrollLeft,scrolled=!1;if(right>container.offsetWidth){container.scrollLeft+=right-container.offsetWidth;scrolled=!0}else{let left=tabItem.offsetLeft-container.scrollLeft;if(0>left){container.scrollLeft-=0-left;scrolled=!0}}if(scrolled){this._evaluateScroll()}}_evaluateScroll(){setTimeout(()=>{this._evaluatePostScroll();setTimeout(()=>{this._evaluatePreScroll()},100)},100)}_evaluatePostScroll(){let container=this.shadowRoot.querySelector("#header-item"),overflowEl=this._getLightDOM(el=>{if("BROWN-TABITEM-DESKTOP"==el.nodeName){let right=el.offsetLeft+el.offsetWidth-container.scrollLeft;return right>container.offsetWidth}return!1}),scroller=this.shadowRoot.querySelector("#post-scroll");if(overflowEl){scroller.classList.add("scroll")}else{scroller.classList.remove("scroll")}}_evaluatePreScroll(){let container=this.shadowRoot.querySelector("#header-item"),overflowEl=this._getLightDOM(el=>{if("BROWN-TABITEM-DESKTOP"==el.nodeName){let left=el.offsetLeft-container.scrollLeft;return 0>left}return!1}),scroller=this.shadowRoot.querySelector("#pre-scroll");if(overflowEl){scroller.classList.add("scroll")}else{scroller.classList.remove("scroll")}}_preScroll(e){let leftest=999,container=this.shadowRoot.querySelector("#header-item");this._getLightDOM(el=>{if("BROWN-TABITEM-DESKTOP"==el.nodeName){let left=el.offsetLeft-container.scrollLeft;leftest=Math.max(leftest,left)}return!1});let scrollSize=container.offsetWidth/5,offset=0-leftest;if(0<offset){scrollSize=Math.min(scrollSize,offset)}container.scrollLeft-=scrollSize;this._evaluateScroll()}_postScroll(e){let rightest=-999,container=this.shadowRoot.querySelector("#header-item");this._getLightDOM(el=>{if("BROWN-TABITEM-DESKTOP"==el.nodeName){let right=el.offsetLeft+el.offsetWidth-container.scrollLeft;rightest=Math.max(rightest,right)}return!1});let scrollSize=container.offsetWidth/5,offset=rightest-container.offsetWidth;if(0<offset){scrollSize=Math.min(scrollSize,offset)}container.scrollLeft+=scrollSize;this._evaluateScroll()}}window.customElements.define("brown-tab-desktop",BrownTabDesktop);