(function() {
	var loaded = 0;
	var srcs = [
		"./node_modules/@beruang/tool/beruang-formfactor.js",
		"./node_modules/@beruang/tool/beruang-inventory.js",
		"./node_modules/@beruang/tool/beruang-place.js",
		"./node_modules/@beruang/tool/loader/" + (window.define ? "loader-es5.js" : "loader-es6.js")
	];

	var f = function() {
		if( srcs.length <= ++loaded ) {
			window.BeruangFactory = function() {
				return {
					create: function(elname, callback) {
						var url = window.BeruangInventory.getSource(elname);
						window.BeruangLoader.importModule(url, null);
						var el = document.createElement(elname);
						var fReady = () => {
							el.removeEventListener("beruang-ready", fReady);
							if(callback) {
								callback(el);
							}
						}
						el.addEventListener("beruang-ready", fReady);
						return el;
					},

					importModule: function(modname, callback) {
						var url = window.BeruangInventory.getSource(modname);
						window.BeruangLoader.importModule(url, callback);
					},

					importMultiModule: function(modnamearr, callback) {
						let urlarr = [];
						let len = modnamearr.length;
						for(let i=0;i<len;i++) {
								urlarr.push(window.BeruangInventory.getSource(modnamearr[i]));
						}
						window.BeruangLoader.importMultiModule(urlarr, callback);
					},
				};
			}();
		}
	}

	for(var s=0;s<srcs.length;s++) {
		var script = document.createElement("script");
		script.type = "text/javascript";
		script.src = srcs[s];
		script.onload = function(){
			document.head.removeChild(this);
			f();
		}.bind(script);
		document.head.appendChild(script);
	}
}());
